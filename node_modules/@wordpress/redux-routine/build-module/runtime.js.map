{"version":3,"sources":["/Users/riad/Workspace/a8c/gutenberg/packages/redux-routine/src/runtime.js"],"names":["create","map","isString","isPromise","castError","isActionOfType","isAction","createRuntime","controls","dispatch","rungenControls","control","actionType","value","next","iterate","yieldNext","yieldError","routine","then","error","unhandledActionControl","push","rungenRuntime","action","Promise","resolve","reject","result","type"],"mappings":";;AAAA;;;AAGA,SAASA,MAAT,QAAuB,QAAvB;AACA,SAASC,GAAT,EAAcC,QAAd,QAA8B,QAA9B;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA;;;;AAGA,OAAOC,SAAP,MAAsB,cAAtB;AACA,SAASC,cAAT,EAAyBC,QAAzB,QAAyC,aAAzC;AAEA;;;;;;;;;AAQA,eAAe,SAASC,aAAT,GAAkD;AAAA,MAA1BC,QAA0B,uEAAf,EAAe;AAAA,MAAXC,QAAW;AAChE,MAAMC,cAAc,GAAGT,GAAG,CAAEO,QAAF,EAAY,UAAEG,OAAF,EAAWC,UAAX;AAAA,WAA2B,UAAEC,KAAF,EAASC,IAAT,EAAeC,OAAf,EAAwBC,SAAxB,EAAmCC,UAAnC,EAAmD;AACnH,UAAK,CAAEZ,cAAc,CAAEQ,KAAF,EAASD,UAAT,CAArB,EAA6C;AAC5C,eAAO,KAAP;AACA;;AACD,UAAMM,OAAO,GAAGP,OAAO,CAAEE,KAAF,CAAvB;;AACA,UAAKV,SAAS,CAAEe,OAAF,CAAd,EAA4B;AAC3B;AACAA,QAAAA,OAAO,CAACC,IAAR,CACCH,SADD,EAEC,UAAEI,KAAF;AAAA,iBAAaH,UAAU,CAAEb,SAAS,CAAEgB,KAAF,CAAX,CAAvB;AAAA,SAFD;AAIA,OAND,MAMO;AACNN,QAAAA,IAAI,CAAEI,OAAF,CAAJ;AACA;;AACD,aAAO,IAAP;AACA,KAfqC;AAAA,GAAZ,CAA1B;;AAiBA,MAAMG,sBAAsB,GAAG,SAAzBA,sBAAyB,CAAER,KAAF,EAASC,IAAT,EAAmB;AACjD,QAAK,CAAER,QAAQ,CAAEO,KAAF,CAAf,EAA2B;AAC1B,aAAO,KAAP;AACA;;AACDJ,IAAAA,QAAQ,CAAEI,KAAF,CAAR;AACAC,IAAAA,IAAI;AACJ,WAAO,IAAP;AACA,GAPD;;AAQAJ,EAAAA,cAAc,CAACY,IAAf,CAAqBD,sBAArB;AAEA,MAAME,aAAa,GAAGvB,MAAM,CAAEU,cAAF,CAA5B;AAEA,SAAO,UAAEc,MAAF;AAAA,WAAc,IAAIC,OAAJ,CAAa,UAAEC,OAAF,EAAWC,MAAX;AAAA,aACjCJ,aAAa,CAAEC,MAAF,EAAU,UAAEI,MAAF,EAAc;AACpC,YAAK,QAAOA,MAAP,MAAkB,QAAlB,IAA8B1B,QAAQ,CAAE0B,MAAM,CAACC,IAAT,CAA3C,EAA6D;AAC5DpB,UAAAA,QAAQ,CAAEmB,MAAF,CAAR;AACA;;AACDF,QAAAA,OAAO,CAAEE,MAAF,CAAP;AACA,OALY,EAKVD,MALU,CADoB;AAAA,KAAb,CAAd;AAAA,GAAP;AAQA","sourcesContent":["/**\n * External dependencies\n */\nimport { create } from 'rungen';\nimport { map, isString } from 'lodash';\nimport isPromise from 'is-promise';\n\n/**\n * Internal dependencies\n */\nimport castError from './cast-error';\nimport { isActionOfType, isAction } from './is-action';\n\n/**\n * Create a co-routine runtime.\n *\n * @param {Object}    controls Object of control handlers.\n * @param {function}  dispatch Unhandled action dispatch.\n *\n * @return {function} co-routine runtime\n */\nexport default function createRuntime( controls = {}, dispatch ) {\n\tconst rungenControls = map( controls, ( control, actionType ) => ( value, next, iterate, yieldNext, yieldError ) => {\n\t\tif ( ! isActionOfType( value, actionType ) ) {\n\t\t\treturn false;\n\t\t}\n\t\tconst routine = control( value );\n\t\tif ( isPromise( routine ) ) {\n\t\t\t// Async control routine awaits resolution.\n\t\t\troutine.then(\n\t\t\t\tyieldNext,\n\t\t\t\t( error ) => yieldError( castError( error ) ),\n\t\t\t);\n\t\t} else {\n\t\t\tnext( routine );\n\t\t}\n\t\treturn true;\n\t} );\n\n\tconst unhandledActionControl = ( value, next ) => {\n\t\tif ( ! isAction( value ) ) {\n\t\t\treturn false;\n\t\t}\n\t\tdispatch( value );\n\t\tnext();\n\t\treturn true;\n\t};\n\trungenControls.push( unhandledActionControl );\n\n\tconst rungenRuntime = create( rungenControls );\n\n\treturn ( action ) => new Promise( ( resolve, reject ) =>\n\t\trungenRuntime( action, ( result ) => {\n\t\t\tif ( typeof result === 'object' && isString( result.type ) ) {\n\t\t\t\tdispatch( result );\n\t\t\t}\n\t\t\tresolve( result );\n\t\t}, reject )\n\t);\n}\n"]}