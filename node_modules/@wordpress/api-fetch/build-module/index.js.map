{"version":3,"sources":["/Users/riad/Workspace/a8c/gutenberg/packages/api-fetch/src/index.js"],"names":["__","createNonceMiddleware","createRootURLMiddleware","createPreloadingMiddleware","fetchAllMiddleware","namespaceEndpointMiddleware","httpV1Middleware","userLocaleMiddleware","DEFAULT_HEADERS","Accept","DEFAULT_OPTIONS","credentials","middlewares","registerMiddleware","middleware","push","apiFetch","options","raw","nextOptions","url","path","data","parse","remainingOptions","body","headers","JSON","stringify","responsePromise","window","fetch","checkStatus","response","status","parseResponse","json","Promise","reject","then","catch","invalidJsonError","code","message","error","unknownError","steps","reverse","runMiddleware","index","nextMiddleware","next","use"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport createNonceMiddleware from './middlewares/nonce';\nimport createRootURLMiddleware from './middlewares/root-url';\nimport createPreloadingMiddleware from './middlewares/preloading';\nimport fetchAllMiddleware from './middlewares/fetch-all-middleware';\nimport namespaceEndpointMiddleware from './middlewares/namespace-endpoint';\nimport httpV1Middleware from './middlewares/http-v1';\nimport userLocaleMiddleware from './middlewares/user-locale';\n\n/**\n * Default set of header values which should be sent with every request unless\n * explicitly provided through apiFetch options.\n *\n * @type {Object}\n */\nconst DEFAULT_HEADERS = {\n\t// The backend uses the Accept header as a condition for considering an\n\t// incoming request as a REST request.\n\t//\n\t// See: https://core.trac.wordpress.org/ticket/44534\n\tAccept: 'application/json, */*;q=0.1',\n};\n\n/**\n * Default set of fetch option values which should be sent with every request\n * unless explicitly provided through apiFetch options.\n *\n * @type {Object}\n */\nconst DEFAULT_OPTIONS = {\n\tcredentials: 'include',\n};\n\nconst middlewares = [];\n\nfunction registerMiddleware( middleware ) {\n\tmiddlewares.push( middleware );\n}\n\nfunction apiFetch( options ) {\n\tconst raw = ( nextOptions ) => {\n\t\tconst { url, path, data, parse = true, ...remainingOptions } = nextOptions;\n\t\tlet { body, headers } = nextOptions;\n\n\t\t// Merge explicitly-provided headers with default values.\n\t\theaders = { ...DEFAULT_HEADERS, ...headers };\n\n\t\t// The `data` property is a shorthand for sending a JSON body.\n\t\tif ( data ) {\n\t\t\tbody = JSON.stringify( data );\n\t\t\theaders[ 'Content-Type' ] = 'application/json';\n\t\t}\n\n\t\tconst responsePromise = window.fetch(\n\t\t\turl || path,\n\t\t\t{\n\t\t\t\t...DEFAULT_OPTIONS,\n\t\t\t\t...remainingOptions,\n\t\t\t\tbody,\n\t\t\t\theaders,\n\t\t\t}\n\t\t);\n\t\tconst checkStatus = ( response ) => {\n\t\t\tif ( response.status >= 200 && response.status < 300 ) {\n\t\t\t\treturn response;\n\t\t\t}\n\n\t\t\tthrow response;\n\t\t};\n\n\t\tconst parseResponse = ( response ) => {\n\t\t\tif ( parse ) {\n\t\t\t\tif ( response.status === 204 ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn response.json ? response.json() : Promise.reject( response );\n\t\t\t}\n\n\t\t\treturn response;\n\t\t};\n\n\t\treturn responsePromise\n\t\t\t.then( checkStatus )\n\t\t\t.then( parseResponse )\n\t\t\t.catch( ( response ) => {\n\t\t\t\tif ( ! parse ) {\n\t\t\t\t\tthrow response;\n\t\t\t\t}\n\n\t\t\t\tconst invalidJsonError = {\n\t\t\t\t\tcode: 'invalid_json',\n\t\t\t\t\tmessage: __( 'The response is not a valid JSON response.' ),\n\t\t\t\t};\n\n\t\t\t\tif ( ! response || ! response.json ) {\n\t\t\t\t\tthrow invalidJsonError;\n\t\t\t\t}\n\n\t\t\t\treturn response.json()\n\t\t\t\t\t.catch( () => {\n\t\t\t\t\t\tthrow invalidJsonError;\n\t\t\t\t\t} )\n\t\t\t\t\t.then( ( error ) => {\n\t\t\t\t\t\tconst unknownError = {\n\t\t\t\t\t\t\tcode: 'unknown_error',\n\t\t\t\t\t\t\tmessage: __( 'An unknown error occurred.' ),\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthrow error || unknownError;\n\t\t\t\t\t} );\n\t\t\t} );\n\t};\n\n\tconst steps = [\n\t\traw,\n\t\tfetchAllMiddleware,\n\t\thttpV1Middleware,\n\t\tnamespaceEndpointMiddleware,\n\t\tuserLocaleMiddleware,\n\t\t...middlewares,\n\t].reverse();\n\n\tconst runMiddleware = ( index ) => ( nextOptions ) => {\n\t\tconst nextMiddleware = steps[ index ];\n\t\tconst next = runMiddleware( index + 1 );\n\t\treturn nextMiddleware( nextOptions, next );\n\t};\n\n\treturn runMiddleware( 0 )( options );\n}\n\napiFetch.use = registerMiddleware;\n\napiFetch.createNonceMiddleware = createNonceMiddleware;\napiFetch.createPreloadingMiddleware = createPreloadingMiddleware;\napiFetch.createRootURLMiddleware = createRootURLMiddleware;\napiFetch.fetchAllMiddleware = fetchAllMiddleware;\n\nexport default apiFetch;\n"]}