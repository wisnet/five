{"version":3,"sources":["/Users/riad/Workspace/a8c/gutenberg/packages/api-fetch/src/middlewares/nonce.js"],"names":["addAction","createNonceMiddleware","nonce","usedNonce","response","options","next","headers","addNonceHeader","headerName","hasOwnProperty","toLowerCase"],"mappings":";;AAAA;;;AAGA,SAASA,SAAT,QAA0B,kBAA1B;;AAEA,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAEC,KAAF,EAAa;AAC1C,MAAIC,SAAS,GAAGD,KAAhB;AAEA;;;;;;;AAMAF,EAAAA,SAAS,CAAE,gBAAF,EAAoB,wCAApB,EAA8D,UAAEI,QAAF,EAAgB;AACtF,QAAKA,QAAQ,CAAE,YAAF,CAAb,EAAgC;AAC/BD,MAAAA,SAAS,GAAGC,QAAQ,CAAE,YAAF,CAApB;AACA;AACD,GAJQ,CAAT;AAMA,SAAO,UAAUC,OAAV,EAAmBC,IAAnB,EAA0B;AAChC,QAAIC,OAAO,GAAGF,OAAO,CAACE,OAAR,IAAmB,EAAjC,CADgC,CAEhC;AACA;;AACA,QAAIC,cAAc,GAAG,IAArB;;AACA,SAAM,IAAMC,UAAZ,IAA0BF,OAA1B,EAAoC;AACnC,UAAKA,OAAO,CAACG,cAAR,CAAwBD,UAAxB,CAAL,EAA4C;AAC3C,YAAKA,UAAU,CAACE,WAAX,OAA6B,YAAlC,EAAiD;AAChDH,UAAAA,cAAc,GAAG,KAAjB;AACA;AACA;AACD;AACD;;AAED,QAAKA,cAAL,EAAsB;AACrB;AACAD,MAAAA,OAAO,qBACHA,OADG;AAEN,sBAAcJ;AAFR,QAAP;AAIA;;AAED,WAAOG,IAAI,mBACPD,OADO;AAEVE,MAAAA,OAAO,EAAPA;AAFU,OAAX;AAIA,GA1BD;AA2BA,CA1CD;;AA4CA,eAAeN,qBAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { addAction } from '@wordpress/hooks';\n\nconst createNonceMiddleware = ( nonce ) => {\n\tlet usedNonce = nonce;\n\n\t/**\n\t * This is not ideal but it's fine for now.\n\t *\n\t * Configure heartbeat to refresh the wp-api nonce, keeping the editor\n\t * authorization intact.\n\t */\n\taddAction( 'heartbeat.tick', 'core/api-fetch/create-nonce-middleware', ( response ) => {\n\t\tif ( response[ 'rest-nonce' ] ) {\n\t\t\tusedNonce = response[ 'rest-nonce' ];\n\t\t}\n\t} );\n\n\treturn function( options, next ) {\n\t\tlet headers = options.headers || {};\n\t\t// If an 'X-WP-Nonce' header (or any case-insensitive variation\n\t\t// thereof) was specified, no need to add a nonce header.\n\t\tlet addNonceHeader = true;\n\t\tfor ( const headerName in headers ) {\n\t\t\tif ( headers.hasOwnProperty( headerName ) ) {\n\t\t\t\tif ( headerName.toLowerCase() === 'x-wp-nonce' ) {\n\t\t\t\t\taddNonceHeader = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( addNonceHeader ) {\n\t\t\t// Do not mutate the original headers object, if any.\n\t\t\theaders = {\n\t\t\t\t...headers,\n\t\t\t\t'X-WP-Nonce': usedNonce,\n\t\t\t};\n\t\t}\n\n\t\treturn next( {\n\t\t\t...options,\n\t\t\theaders,\n\t\t} );\n\t};\n};\n\nexport default createNonceMiddleware;\n"]}