{"version":3,"sources":["/Users/riad/Workspace/a8c/gutenberg/packages/components/src/form-token-field/index.js"],"names":["initialState","incompleteTokenValue","inputOffsetFromEnd","isActive","isExpanded","selectedSuggestionIndex","selectedSuggestionScroll","FormTokenField","arguments","state","onKeyDown","bind","onKeyPress","onFocus","onBlur","deleteTokenBeforeInput","deleteTokenAfterInput","addCurrentToken","onContainerTouched","renderToken","onTokenClickRemove","onSuggestionHovered","onSuggestionSelected","onInputChange","bindInput","bindTokensAndInput","input","hasFocus","focus","ref","tokensAndInput","event","target","setState","props","inputHasValidValue","preventDefault","keyCode","BACKSPACE","handleDeleteKey","ENTER","LEFT","handleLeftArrowKey","UP","handleUpArrowKey","RIGHT","handleRightArrowKey","DOWN","handleDownArrowKey","DELETE","SPACE","tokenizeOnSpace","ESCAPE","handleEscapeKey","stopPropagation","charCode","handleCommaKey","deleteToken","value","suggestion","index","getMatchingSuggestions","indexOf","addNewToken","text","separator","items","split","tokenValue","inputHasMinimumChars","trim","length","matchingSuggestions","hasVisibleSuggestions","addNewTokens","slice","debouncedSpeak","isInputEmpty","moveInputBeforePreviousToken","moveInputAfterNextToken","suggestions","maxSuggestions","saveTransform","Math","max","min","getIndexOfInput","moveInputToIndex","selectedSuggestion","getSelectedSuggestion","tokens","tokensToAdd","map","filter","Boolean","token","valueContainsToken","newValue","splice","apply","concat","onChange","speak","messages","added","newTokens","item","getTokenValue","removed","searchValue","match","startsWithMatch","containsMatch","toLocaleLowerCase","push","components","renderInput","status","undefined","termPosition","termsCount","title","displayTransform","isBorderless","onMouseEnter","onMouseLeave","disabled","autoCapitalize","autoComplete","maxLength","instanceId","key","label","className","classes","tokenFieldProps","tabIndex","Object","assign","renderTokensAndInput","Component","defaultProps","freeze","identity","remove"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { last, take, clone, uniq, map, difference, each, identity, some } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { withInstanceId } from '@wordpress/compose';\nimport { BACKSPACE, ENTER, UP, DOWN, LEFT, RIGHT, SPACE, DELETE, ESCAPE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport Token from './token';\nimport TokenInput from './token-input';\nimport SuggestionsList from './suggestions-list';\nimport withSpokenMessages from '../higher-order/with-spoken-messages';\n\nconst initialState = {\n\tincompleteTokenValue: '',\n\tinputOffsetFromEnd: 0,\n\tisActive: false,\n\tisExpanded: false,\n\tselectedSuggestionIndex: -1,\n\tselectedSuggestionScroll: false,\n};\n\nclass FormTokenField extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = initialState;\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.onKeyPress = this.onKeyPress.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.deleteTokenBeforeInput = this.deleteTokenBeforeInput.bind( this );\n\t\tthis.deleteTokenAfterInput = this.deleteTokenAfterInput.bind( this );\n\t\tthis.addCurrentToken = this.addCurrentToken.bind( this );\n\t\tthis.onContainerTouched = this.onContainerTouched.bind( this );\n\t\tthis.renderToken = this.renderToken.bind( this );\n\t\tthis.onTokenClickRemove = this.onTokenClickRemove.bind( this );\n\t\tthis.onSuggestionHovered = this.onSuggestionHovered.bind( this );\n\t\tthis.onSuggestionSelected = this.onSuggestionSelected.bind( this );\n\t\tthis.onInputChange = this.onInputChange.bind( this );\n\t\tthis.bindInput = this.bindInput.bind( this );\n\t\tthis.bindTokensAndInput = this.bindTokensAndInput.bind( this );\n\t}\n\n\tcomponentDidUpdate() {\n\t\t// Make sure to focus the input when the isActive state is true.\n\t\tif ( this.state.isActive && ! this.input.hasFocus() ) {\n\t\t\tthis.input.focus();\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\tif ( ! props.disabled || ! state.isActive ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tisActive: false,\n\t\t\tincompleteTokenValue: '',\n\t\t};\n\t}\n\n\tbindInput( ref ) {\n\t\tthis.input = ref;\n\t}\n\n\tbindTokensAndInput( ref ) {\n\t\tthis.tokensAndInput = ref;\n\t}\n\n\tonFocus( event ) {\n\t\t// If focus is on the input or on the container, set the isActive state to true.\n\t\tif ( this.input.hasFocus() || event.target === this.tokensAndInput ) {\n\t\t\tthis.setState( { isActive: true } );\n\t\t} else {\n\t\t\t/*\n\t\t\t * Otherwise, focus is on one of the token \"remove\" buttons and we\n\t\t\t * set the isActive state to false to prevent the input to be\n\t\t\t * re-focused, see componentDidUpdate().\n\t\t\t */\n\t\t\tthis.setState( { isActive: false } );\n\t\t}\n\n\t\tif ( 'function' === typeof this.props.onFocus ) {\n\t\t\tthis.props.onFocus( event );\n\t\t}\n\t}\n\n\tonBlur() {\n\t\tif ( this.inputHasValidValue() ) {\n\t\t\tthis.setState( { isActive: false } );\n\t\t} else {\n\t\t\tthis.setState( initialState );\n\t\t}\n\t}\n\n\tonKeyDown( event ) {\n\t\tlet preventDefault = false;\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase BACKSPACE:\n\t\t\t\tpreventDefault = this.handleDeleteKey( this.deleteTokenBeforeInput );\n\t\t\t\tbreak;\n\t\t\tcase ENTER:\n\t\t\t\tpreventDefault = this.addCurrentToken();\n\t\t\t\tbreak;\n\t\t\tcase LEFT:\n\t\t\t\tpreventDefault = this.handleLeftArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase UP:\n\t\t\t\tpreventDefault = this.handleUpArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase RIGHT:\n\t\t\t\tpreventDefault = this.handleRightArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\tpreventDefault = this.handleDownArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase DELETE:\n\t\t\t\tpreventDefault = this.handleDeleteKey( this.deleteTokenAfterInput );\n\t\t\t\tbreak;\n\t\t\tcase SPACE:\n\t\t\t\tif ( this.props.tokenizeOnSpace ) {\n\t\t\t\t\tpreventDefault = this.addCurrentToken();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ESCAPE:\n\t\t\t\tpreventDefault = this.handleEscapeKey( event );\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonKeyPress( event ) {\n\t\tlet preventDefault = false;\n\t\tswitch ( event.charCode ) {\n\t\t\tcase 44: // comma\n\t\t\t\tpreventDefault = this.handleCommaKey();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonContainerTouched( event ) {\n\t\t// Prevent clicking/touching the tokensAndInput container from blurring\n\t\t// the input and adding the current token.\n\t\tif ( event.target === this.tokensAndInput && this.state.isActive ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonTokenClickRemove( event ) {\n\t\tthis.deleteToken( event.value );\n\t\tthis.input.focus();\n\t}\n\n\tonSuggestionHovered( suggestion ) {\n\t\tconst index = this.getMatchingSuggestions().indexOf( suggestion );\n\n\t\tif ( index >= 0 ) {\n\t\t\tthis.setState( {\n\t\t\t\tselectedSuggestionIndex: index,\n\t\t\t\tselectedSuggestionScroll: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonSuggestionSelected( suggestion ) {\n\t\tthis.addNewToken( suggestion );\n\t}\n\n\tonInputChange( event ) {\n\t\tconst text = event.value;\n\t\tconst separator = this.props.tokenizeOnSpace ? /[ ,\\t]+/ : /[,\\t]+/;\n\t\tconst items = text.split( separator );\n\t\tconst tokenValue = last( items ) || '';\n\t\tconst inputHasMinimumChars = tokenValue.trim().length > 1;\n\t\tconst matchingSuggestions = this.getMatchingSuggestions( tokenValue );\n\t\tconst hasVisibleSuggestions = inputHasMinimumChars && !! matchingSuggestions.length;\n\n\t\tif ( items.length > 1 ) {\n\t\t\tthis.addNewTokens( items.slice( 0, -1 ) );\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: tokenValue,\n\t\t\tselectedSuggestionIndex: -1,\n\t\t\tselectedSuggestionScroll: false,\n\t\t\tisExpanded: false,\n\t\t} );\n\n\t\tthis.props.onInputChange( tokenValue );\n\n\t\tif ( inputHasMinimumChars ) {\n\t\t\tthis.setState( {\n\t\t\t\tisExpanded: hasVisibleSuggestions,\n\t\t\t} );\n\n\t\t\tif ( !! matchingSuggestions.length ) {\n\t\t\t\tthis.props.debouncedSpeak( sprintf( _n(\n\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t), matchingSuggestions.length ), 'assertive' );\n\t\t\t} else {\n\t\t\t\tthis.props.debouncedSpeak( __( 'No results.' ), 'assertive' );\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDeleteKey( deleteToken ) {\n\t\tlet preventDefault = false;\n\t\tif ( this.input.hasFocus() && this.isInputEmpty() ) {\n\t\t\tdeleteToken();\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\thandleLeftArrowKey() {\n\t\tlet preventDefault = false;\n\t\tif ( this.isInputEmpty() ) {\n\t\t\tthis.moveInputBeforePreviousToken();\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\thandleRightArrowKey() {\n\t\tlet preventDefault = false;\n\t\tif ( this.isInputEmpty() ) {\n\t\t\tthis.moveInputAfterNextToken();\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\thandleUpArrowKey() {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tselectedSuggestionIndex: (\n\t\t\t\t( state.selectedSuggestionIndex === 0 ? this.getMatchingSuggestions(\n\t\t\t\t\tstate.incompleteTokenValue,\n\t\t\t\t\tprops.suggestions,\n\t\t\t\t\tprops.value,\n\t\t\t\t\tprops.maxSuggestions,\n\t\t\t\t\tprops.saveTransform\n\t\t\t\t).length : state.selectedSuggestionIndex ) - 1\n\t\t\t),\n\t\t\tselectedSuggestionScroll: true,\n\t\t} ) );\n\n\t\treturn true; // preventDefault\n\t}\n\n\thandleDownArrowKey() {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tselectedSuggestionIndex: (\n\t\t\t\t( state.selectedSuggestionIndex + 1 ) % this.getMatchingSuggestions(\n\t\t\t\t\tstate.incompleteTokenValue,\n\t\t\t\t\tprops.suggestions,\n\t\t\t\t\tprops.value,\n\t\t\t\t\tprops.maxSuggestions,\n\t\t\t\t\tprops.saveTransform\n\t\t\t\t).length\n\t\t\t),\n\t\t\tselectedSuggestionScroll: true,\n\t\t} ) );\n\n\t\treturn true; // preventDefault\n\t}\n\n\thandleEscapeKey( event ) {\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: event.target.value,\n\t\t\tisExpanded: false,\n\t\t\tselectedSuggestionIndex: -1,\n\t\t\tselectedSuggestionScroll: false,\n\t\t} );\n\t\treturn true; // preventDefault\n\t}\n\n\thandleCommaKey() {\n\t\tif ( this.inputHasValidValue() ) {\n\t\t\tthis.addNewToken( this.state.incompleteTokenValue );\n\t\t}\n\n\t\treturn true; // preventDefault\n\t}\n\n\tmoveInputToIndex( index ) {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tinputOffsetFromEnd: props.value.length - Math.max( index, -1 ) - 1,\n\t\t} ) );\n\t}\n\n\tmoveInputBeforePreviousToken() {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tinputOffsetFromEnd: Math.min( state.inputOffsetFromEnd + 1, props.value.length ),\n\t\t} ) );\n\t}\n\n\tmoveInputAfterNextToken() {\n\t\tthis.setState( ( state ) => ( {\n\t\t\tinputOffsetFromEnd: Math.max( state.inputOffsetFromEnd - 1, 0 ),\n\t\t} ) );\n\t}\n\n\tdeleteTokenBeforeInput() {\n\t\tconst index = this.getIndexOfInput() - 1;\n\n\t\tif ( index > -1 ) {\n\t\t\tthis.deleteToken( this.props.value[ index ] );\n\t\t}\n\t}\n\n\tdeleteTokenAfterInput() {\n\t\tconst index = this.getIndexOfInput();\n\n\t\tif ( index < this.props.value.length ) {\n\t\t\tthis.deleteToken( this.props.value[ index ] );\n\t\t\t// update input offset since it's the offset from the last token\n\t\t\tthis.moveInputToIndex( index );\n\t\t}\n\t}\n\n\taddCurrentToken() {\n\t\tlet preventDefault = false;\n\t\tconst selectedSuggestion = this.getSelectedSuggestion();\n\n\t\tif ( selectedSuggestion ) {\n\t\t\tthis.addNewToken( selectedSuggestion );\n\t\t\tpreventDefault = true;\n\t\t} else if ( this.inputHasValidValue() ) {\n\t\t\tthis.addNewToken( this.state.incompleteTokenValue );\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\taddNewTokens( tokens ) {\n\t\tconst tokensToAdd = uniq(\n\t\t\ttokens\n\t\t\t\t.map( this.props.saveTransform )\n\t\t\t\t.filter( Boolean )\n\t\t\t\t.filter( ( token ) => ! this.valueContainsToken( token ) )\n\t\t);\n\n\t\tif ( tokensToAdd.length > 0 ) {\n\t\t\tconst newValue = clone( this.props.value );\n\t\t\tnewValue.splice.apply(\n\t\t\t\tnewValue,\n\t\t\t\t[ this.getIndexOfInput(), 0 ].concat( tokensToAdd )\n\t\t\t);\n\t\t\tthis.props.onChange( newValue );\n\t\t}\n\t}\n\n\taddNewToken( token ) {\n\t\tthis.addNewTokens( [ token ] );\n\t\tthis.props.speak( this.props.messages.added, 'assertive' );\n\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: '',\n\t\t\tselectedSuggestionIndex: -1,\n\t\t\tselectedSuggestionScroll: false,\n\t\t\tisExpanded: false,\n\t\t} );\n\n\t\tif ( this.state.isActive ) {\n\t\t\tthis.input.focus();\n\t\t}\n\t}\n\n\tdeleteToken( token ) {\n\t\tconst newTokens = this.props.value.filter( ( item ) => {\n\t\t\treturn this.getTokenValue( item ) !== this.getTokenValue( token );\n\t\t} );\n\t\tthis.props.onChange( newTokens );\n\t\tthis.props.speak( this.props.messages.removed, 'assertive' );\n\t}\n\n\tgetTokenValue( token ) {\n\t\tif ( 'object' === typeof token ) {\n\t\t\treturn token.value;\n\t\t}\n\n\t\treturn token;\n\t}\n\n\tgetMatchingSuggestions(\n\t\tsearchValue = this.state.incompleteTokenValue,\n\t\tsuggestions = this.props.suggestions,\n\t\tvalue = this.props.value,\n\t\tmaxSuggestions = this.props.maxSuggestions,\n\t\tsaveTransform = this.props.saveTransform,\n\t) {\n\t\tlet match = saveTransform( searchValue );\n\t\tconst startsWithMatch = [];\n\t\tconst containsMatch = [];\n\n\t\tif ( match.length === 0 ) {\n\t\t\tsuggestions = difference( suggestions, value );\n\t\t} else {\n\t\t\tmatch = match.toLocaleLowerCase();\n\n\t\t\teach( suggestions, ( suggestion ) => {\n\t\t\t\tconst index = suggestion.toLocaleLowerCase().indexOf( match );\n\t\t\t\tif ( value.indexOf( suggestion ) === -1 ) {\n\t\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\t\tstartsWithMatch.push( suggestion );\n\t\t\t\t\t} else if ( index > 0 ) {\n\t\t\t\t\t\tcontainsMatch.push( suggestion );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tsuggestions = startsWithMatch.concat( containsMatch );\n\t\t}\n\n\t\treturn take( suggestions, maxSuggestions );\n\t}\n\n\tgetSelectedSuggestion() {\n\t\tif ( this.state.selectedSuggestionIndex !== -1 ) {\n\t\t\treturn this.getMatchingSuggestions()[ this.state.selectedSuggestionIndex ];\n\t\t}\n\t}\n\n\tvalueContainsToken( token ) {\n\t\treturn some( this.props.value, ( item ) => {\n\t\t\treturn this.getTokenValue( token ) === this.getTokenValue( item );\n\t\t} );\n\t}\n\n\tgetIndexOfInput() {\n\t\treturn this.props.value.length - this.state.inputOffsetFromEnd;\n\t}\n\n\tisInputEmpty() {\n\t\treturn this.state.incompleteTokenValue.length === 0;\n\t}\n\n\tinputHasValidValue() {\n\t\treturn this.props.saveTransform( this.state.incompleteTokenValue ).length > 0;\n\t}\n\n\trenderTokensAndInput() {\n\t\tconst components = map( this.props.value, this.renderToken );\n\t\tcomponents.splice( this.getIndexOfInput(), 0, this.renderInput() );\n\n\t\treturn components;\n\t}\n\n\trenderToken( token, index, tokens ) {\n\t\tconst value = this.getTokenValue( token );\n\t\tconst status = token.status ? token.status : undefined;\n\t\tconst termPosition = index + 1;\n\t\tconst termsCount = tokens.length;\n\n\t\treturn (\n\t\t\t<Token\n\t\t\t\tkey={ 'token-' + value }\n\t\t\t\tvalue={ value }\n\t\t\t\tstatus={ status }\n\t\t\t\ttitle={ token.title }\n\t\t\t\tdisplayTransform={ this.props.displayTransform }\n\t\t\t\tonClickRemove={ this.onTokenClickRemove }\n\t\t\t\tisBorderless={ token.isBorderless || this.props.isBorderless }\n\t\t\t\tonMouseEnter={ token.onMouseEnter }\n\t\t\t\tonMouseLeave={ token.onMouseLeave }\n\t\t\t\tdisabled={ 'error' !== status && this.props.disabled }\n\t\t\t\tmessages={ this.props.messages }\n\t\t\t\ttermsCount={ termsCount }\n\t\t\t\ttermPosition={ termPosition }\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderInput() {\n\t\tconst { autoCapitalize, autoComplete, maxLength, value, instanceId } = this.props;\n\n\t\tlet props = {\n\t\t\tinstanceId,\n\t\t\tautoCapitalize,\n\t\t\tautoComplete,\n\t\t\tref: this.bindInput,\n\t\t\tkey: 'input',\n\t\t\tdisabled: this.props.disabled,\n\t\t\tvalue: this.state.incompleteTokenValue,\n\t\t\tonBlur: this.onBlur,\n\t\t\tisExpanded: this.state.isExpanded,\n\t\t\tselectedSuggestionIndex: this.state.selectedSuggestionIndex,\n\t\t};\n\n\t\tif ( ! ( maxLength && value.length >= maxLength ) ) {\n\t\t\tprops = { ...props, onChange: this.onInputChange };\n\t\t}\n\n\t\treturn (\n\t\t\t<TokenInput { ...props } />\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\tlabel = __( 'Add item' ),\n\t\t\tinstanceId,\n\t\t\tclassName,\n\t\t} = this.props;\n\t\tconst { isExpanded } = this.state;\n\t\tconst classes = classnames( className, 'components-form-token-field__input-container', {\n\t\t\t'is-active': this.state.isActive,\n\t\t\t'is-disabled': disabled,\n\t\t} );\n\n\t\tlet tokenFieldProps = {\n\t\t\tclassName: 'components-form-token-field',\n\t\t\ttabIndex: '-1',\n\t\t};\n\t\tconst matchingSuggestions = this.getMatchingSuggestions();\n\n\t\tif ( ! disabled ) {\n\t\t\ttokenFieldProps = Object.assign( {}, tokenFieldProps, {\n\t\t\t\tonKeyDown: this.onKeyDown,\n\t\t\t\tonKeyPress: this.onKeyPress,\n\t\t\t\tonFocus: this.onFocus,\n\t\t\t} );\n\t\t}\n\n\t\t// Disable reason: There is no appropriate role which describes the\n\t\t// input container intended accessible usability.\n\t\t// TODO: Refactor click detection to use blur to stop propagation.\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\treturn (\n\t\t\t<div { ...tokenFieldProps }>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor={ `components-form-token-input-${ instanceId }` }\n\t\t\t\t\tclassName=\"components-form-token-field__label\"\n\t\t\t\t>\n\t\t\t\t\t{ label }\n\t\t\t\t</label>\n\t\t\t\t<div ref={ this.bindTokensAndInput }\n\t\t\t\t\tclassName={ classes }\n\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\tonMouseDown={ this.onContainerTouched }\n\t\t\t\t\tonTouchStart={ this.onContainerTouched }\n\t\t\t\t>\n\t\t\t\t\t{ this.renderTokensAndInput() }\n\t\t\t\t\t{ isExpanded && (\n\t\t\t\t\t\t<SuggestionsList\n\t\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\t\tmatch={ this.props.saveTransform( this.state.incompleteTokenValue ) }\n\t\t\t\t\t\t\tdisplayTransform={ this.props.displayTransform }\n\t\t\t\t\t\t\tsuggestions={ matchingSuggestions }\n\t\t\t\t\t\t\tselectedIndex={ this.state.selectedSuggestionIndex }\n\t\t\t\t\t\t\tscrollIntoView={ this.state.selectedSuggestionScroll }\n\t\t\t\t\t\t\tonHover={ this.onSuggestionHovered }\n\t\t\t\t\t\t\tonSelect={ this.onSuggestionSelected }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t\t<div id={ `components-form-token-suggestions-howto-${ instanceId }` } className=\"screen-reader-text\">\n\t\t\t\t\t{ __( 'Separate with commas' ) }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t}\n}\n\nFormTokenField.defaultProps = {\n\tsuggestions: Object.freeze( [] ),\n\tmaxSuggestions: 100,\n\tvalue: Object.freeze( [] ),\n\tdisplayTransform: identity,\n\tsaveTransform: ( token ) => token.trim(),\n\tonChange: () => {},\n\tonInputChange: () => {},\n\tisBorderless: false,\n\tdisabled: false,\n\ttokenizeOnSpace: false,\n\tmessages: {\n\t\tadded: __( 'Item added.' ),\n\t\tremoved: __( 'Item removed.' ),\n\t\tremove: __( 'Remove item' ),\n\t},\n};\n\nexport default withSpokenMessages( withInstanceId( FormTokenField ) );\n"]}